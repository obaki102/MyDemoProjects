
@inject IDialogService DialogService
@inject IRetrieveAuthState RetrieveAuthState
@inject CustomAuthStateProvider CustomAuthStateProvider
<MudMenu AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopLeft">
    <ActivatorContent>
        @if (string.IsNullOrEmpty(userSettings.ProfileUrl))
        {
            <MudAvatar Color="Color.Secondary">@userSettings.Initials</MudAvatar>
        }
        else
        {
            <MudAvatar Image="@userSettings.ProfileUrl" Style="height:50px; width:50px;"> </MudAvatar>
        }
    </ActivatorContent>
    <ChildContent>
        <MudMenuItem>
            <MudCard Elevation="0" Square="true" Class="mt-n2">
                <MudCardHeader>
                    <CardHeaderAvatar>
                        @if (string.IsNullOrEmpty(userSettings.ProfileUrl))
                        {
                            <MudAvatar Color="Color.Secondary">@userSettings.Name</MudAvatar>
                        }
                        else
                        {
                            <MudAvatar Image="@userSettings.ProfileUrl" Style="height:50px; width:50px;"> </MudAvatar>
                        }
                    </CardHeaderAvatar>
                    <CardHeaderContent>
                        <MudText Typo="Typo.caption">@userSettings.Email</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
            </MudCard>
        </MudMenuItem>
        <MudDivider Class="mb-2" />
        <MudListItem Icon="@Icons.Filled.Logout" Text="Sign Out" OnClick="SignOut" />
    </ChildContent>
</MudMenu>


@code {
    private bool _drawerProfileOpen = true;
    private bool _drawerOpen = true;
    private Dictionary<string, string> claims = new Dictionary<string, string>();
    private User userSettings = new User();
    private void OpenDialog()
    {
        DialogService.Show<Login>("Login", new DialogOptions { MaxWidth = MaxWidth.Small, FullWidth = true, NoHeader = true });
    }


    private void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }
    private void ToggleProfileDrawer()
    {
        _drawerProfileOpen = !_drawerProfileOpen;
    }
    private async Task SignOut()
    {
        await CustomAuthStateProvider.LogOutAndUpdateAuthenticationState();
    }

    protected override void OnInitialized()
    {
        userSettings =  CustomAuthStateProvider.UserSettings;
    }
}
